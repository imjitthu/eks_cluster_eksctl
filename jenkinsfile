pipeline {

    agent any

    parameters {
        choice(name: 'EKS_Cluster', choices: ['Create', 'Delete',], description: 'Pick option')
                }

    stages {
        stage ('Creating Eks Cluster') {
            when {
                expression {params.EKS_Cluster == 'Create'}
            }
            steps {
                sh '''
                eksctl create cluster -f cluster.yml
                '''
            }
        }
        stage ('Deleting Eks Cluster') {
            when {
                expression {params.EKS_Cluster == 'Delete'}
            }
            steps {
                sh '''
                eksctl delete cluster -f cluster.yml
                '''
            }
        }
        stage ('Installing DB and Cache Components') {
            when {
                expression {params.EKS_Cluster == 'Create'}
            }
            steps {
            sh "helm repo add stable https://charts.helm.sh/stable"
            sh "helm install redis stable/redis --set usePassword=false"
            sh "helm install mongodb bitnami/mongodb --set auth.enabled=false"
            sh "helm install rabbitmq bitnami/rabbitmq"
            sh "helm install mysql stable/mysql"
            }
        }
    }
}